<template>
    <lightning-card title="OKR Dashboard" icon-name="standard:dashboard">
        <div class="top">
            <div class="left">
                    <p>User: <span>{displayedUserName}</span></p>
                    <p>Year: <span>{yearValue}</span></p>
            </div>
            <div class="right">
                <lightning-combobox
                    name="changeYear"
                    label="Change year"
                    value={yearValue}
                    placeholder="Select Year"
                    options={yearOptions}
                    onchange={handleYearChange}
                    dropdown-alignment="auto" 
                ></lightning-combobox>

                <lightning-combobox
                    name="selectUser"
                    label="Select a user"
                    value={userValue}
                    placeholder="Select user"
                    options={userOptions}
                    onchange={handleUserChange}
                    dropdown-alignment="auto"  
                ></lightning-combobox>

                <lightning-combobox
                    name="createNew"
                    label="Create"
                    value={value}
                    placeholder="New"
                    options={creatingOptions}
                    onchange={handleCreatingChange}
                    dropdown-alignment="auto"  
                ></lightning-combobox>

            </div>
        </div>

        <template if:true={isYearSelected}>
            <template if:true={hasObjectives}>
                <template for:each={objectives} for:item="obj">
                    <hr key={obj.Id}>
                    <div key={obj.Id} class="main">
                        <p class="slds-text-heading_medium">{obj.Name}</p>
                        <p> {obj.Year__c}</p>
                        <template if:true={obj.Key_Results__r}>
                            <template for:each={obj.Key_Results__r} for:item="keyResult">
                                <div class="sub-main" key={keyResult.Id}>
                                    <c-key-result-child
                                        key-result={keyResult}>
                                    </c-key-result-child>
                                </div>
                                
                            </template>
                            
                        </template>
                        <template if:false={obj.Key_Results__r}>
                                <div class="slds-text-color_weak slds-m-top_small">
                                    <p>There are no key results for this objective.</p>
                                </div>
                        </template>
                    </div>
                </template>
            </template>

            <template if:false={hasObjectives}>
                <div class="noObjectives">
                    <hr>
                    <p class="">There are no objectives for selected year.</p>
                </div>
            </template>
        </template>
        
        
    </lightning-card>

    <template if:true={showObjectiveForm}>
        <c-objective-form
            current-year={currentYear}
            selected-user-id={selectedUserId}
            onsave={handleObjectiveSave}
            oncancel={handleObjectiveCancel}
        ></c-objective-form>
    </template>

    <!-- Key Result Form Pop-up using child component keyResultForm -->
    <template if:true={showKeyResultForm}>
        <c-key-result-form 
            selected-user-id={selectedUserId}
            onsave={handleKeyResultSave}
            oncancel={handleKeyResultCancel}
        ></c-key-result-form>
    </template>

    <template if:true={showReviewForm}>
        <c-review-form
            selected-user-id={selectedUserId}
            onsave={handleReviewSave}
            oncancel={handleReviewCancel}
        ></c-review-form>
    </template>

    <template if:true={showSurveyForm}>
        <c-survey-form
            selected-user-id={selectedUserId}
            onsave={handleSurveySave}
            oncancel={handleSurveyCancel}
        ></c-survey-form>
    </template>

    <template if:true={showCaseStudyForm}>
        <c-case-study-form
            selected-user-id={selectedUserId}
            onsave={handleCaseStudySave}
            oncancel={handleCaseStudyCancel}
        ></c-case-study-form>
    </template>
    
    <template if:true={showGoogleReviewForm}>
        <c-google-review-form
            selected-user-id={selectedUserId}
            onsave={handleGoogleReviewSave}
            oncancel={handleGoogleReviewCancel}
        ></c-google-review-form>
    </template>

</template>